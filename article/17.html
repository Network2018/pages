<!-- build time:Thu May 03 2018 22:55:48 GMT+0800 (中国标准时间) --><!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0" name="viewport"><link href="https://static.sometimesnaive.org:9004/deps/imgs/favicon.ico" type="image/x-icon" rel="icon"><title>使用 Cloudflare PageRules 实现强制 HTTPS 跳转和 301 重定向 | 南琴浪博客</title><link href="https://static.sometimesnaive.org:9004/deps/css/style.min.css" type="text/css" rel="stylesheet"><script src="https://static.sometimesnaive.org:9004/deps/js/jquery.min.js" type="application/javascript"></script><link href="https://static.sometimesnaive.org:9004/deps/css/nprogress.min.css" type="text/css" rel="stylesheet"><script src="https://static.sometimesnaive.org:9004/deps/js/nprogress.min.js" type="application/javascript"></script><link href="https://static.sometimesnaive.org:9004/deps/css/prism.min.css" type="text/css" rel="stylesheet"><script src="https://static.sometimesnaive.org:9004/deps/js/prism.min.js" type="application/javascript"></script><link href="https://static.sometimesnaive.org:9004/deps/css/gitment.min.css" type="text/css" rel="stylesheet"><script src="https://static.sometimesnaive.org:9004/deps/js/gitment.min.js" type="application/javascript"></script></head><body><header class="header fixed-header"><div class="header-container"><a class="home-link" href="/">南琴浪博客</a><ul class="right-list"><li class="list-item"><a href="/" class="item-link">Home</a></li><li class="list-item"><a href="/archive/" class="item-link">Archive</a></li><li class="list-item"><a href="/portal/atom.xml" class="item-link">RSS</a></li><li class="list-item"><a href="/portal/friendly-links" class="item-link">Links</a></li></ul><div class="menu-mask"><ul class="menu-list"><li class="menu-item"><a href="/" class="menu-link">Home</a></li><li class="menu-item"><a href="/archive/" class="menu-link">Archive</a></li><li class="menu-item"><a href="/portal/atom.xml" class="menu-link">RSS</a></li><li class="menu-item"><a href="/portal/friendly-links" class="menu-link">Links</a></li></ul></div></div></header><div id="article-banner"><h2>使用 Cloudflare PageRules 实现强制 HTTPS 跳转和 301 重定向</h2><p class="post-date">10/29/2017</p></div><main class="app-body flex-box"><article class="post-article"><section class="markdown-content"><p>本文介绍如何使用 Cloudflare PageRules 实现强制 HTTPS 跳转和 301 重定向。<br><a id="more"></a></p><p>在我的上一篇文章 <a href="https://sometimesnaive.org/article/29" rel="external nofollow noopener noreferrer" target="_blank">本博客 Nginx 配置（系列三） 完整篇</a> 中，可能有细心的朋友会发现，怎么你的站点中没有强制 HTTPS 跳转的配置呢，明明用 HTTP 访问你的域名能被跳转到 HTTPS 啊？那是因为，我压根就没有使用 Nginx 的重定向功能。</p><p><code>Cloudflare PageRules</code> 是非常强大的功能，我就是利用它来达到这个目的。</p><h2 id="强制-HTTPS-跳转"><a href="#强制-HTTPS-跳转" class="headerlink" title="强制 HTTPS 跳转"></a>强制 HTTPS 跳转</h2><p>实现 <code>强制 HTTPS 跳转</code> 的方法很简单，只需配置成如图所示：<br><img src="https://static.sometimesnaive.org:9004/images/cloudflare-pagerules/21.png" alt="按照如图所示配置"><br><img src="https://static.sometimesnaive.org:9004/images/cloudflare-pagerules/22.png" alt="配置完成后"></p><h2 id="301-重定向"><a href="#301-重定向" class="headerlink" title="301 重定向"></a>301 重定向</h2><p>因为本站不久前换了域名，从 www.nanqinlang.com 搬迁到了现在的 sometimesnaive.org ，强制 HTTPS 跳转肯定是必须的（配合 <a href="https://sometimesnaive.org/article/9#HTTP-Strict-Transport-Security" rel="external nofollow noopener noreferrer" target="_blank">HSTS</a> 还能提高性能）。并且同时，我也需要一个 301 重定向来让对旧域名的访问跳转到新域名。</p><p>要实现这两项功能，需要在 Cloudflare PageRules 中进行以下操作：</p><p>1.<code>旧域名的 HTTPS 跳转</code><br><img src="https://static.sometimesnaive.org:9004/images/cloudflare-pagerules/11.png" alt="旧域名的 HTTPS 跳转"></p><p>2.<code>旧域名 301 重定向到新域名</code><br><img src="https://static.sometimesnaive.org:9004/images/cloudflare-pagerules/12.png" alt="旧域名 301 重定向到新域名"></p><p>上面两步完成后，应该是这样的<br><img src="https://static.sometimesnaive.org:9004/images/cloudflare-pagerules/13.png" alt="上面两步完成后"></p><p>3.<code>旧域名指向一个有效的 ip</code><br>把旧域名指向随便一个有效的 ip，当然，就算能随便指定也不要随便指定，安全起见，建议就像我这样，把旧域名指向 opendns 的 ip<br><img src="https://static.sometimesnaive.org:9004/images/cloudflare-pagerules/14.png" alt="旧域名指向一个有效的 ip"></p><p>4.<code>新域名的 HTTPS 跳转</code><br>这一步操作和上面 301 重定向部分所讲的一样，这里不再重复。</p><p>以上完成后，就能达到以下效果：</p><pre><code class="language-html">1. 访问 http://www.nanqinlang.com（跳转到 https://www.nanqinlang.com 再）跳转到 https://sometimesnaive.org

2. 访问 https://www.nanqinlang.com  跳转到 https://sometimesnaive.org

3. 访问 http://sometimesnaive.org      跳转到 https://sometimesnaive.org
</code></pre></section><br><div class="article-footer"><br><p>本文可能过时失效，若需更新，请留言</p><p>本博客文章均为原创，转载请注明来源</p></div><div class="nav-container"><a class="nav-right" href="/article/16.html">本博客 Nginx 配置（系列二） 性能篇 <span class="nav-arrow">→</span> </a><a class="nav-left" href="/article/18.html"><span class="nav-arrow">← </span>Nginx 启用 RSA &amp;&amp; ECC 双证书</a></div><div id="comments"></div></article><aside class="catalog-container"><div class="toc-main"><strong class="toc-title">Catalog</strong><ol class="toc-nav"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#强制-HTTPS-跳转"><span class="toc-nav-text">强制 HTTPS 跳转</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#301-重定向"><span class="toc-nav-text">301 重定向</span></a></li></ol></div></aside></main><script>!function(){var e="https://static.sometimesnaive.org:9004/deps/imgs/banner.jpg";$("#article-banner").css({"background-image":"url("+e+")"}),$(".header").removeClass("fixed-header")}()</script><script>(function(){
    var gitmentConfig = "nanqinlang"
    if (gitmentConfig !== 'undefined') {
        var gitment = new Gitment({
            id: "17",
            owner: "nanqinlang",
            repo: "sometimesnaive.org",
            oauth: {client_id: "b0612de512484ab34c7a", client_secret: "c2bc4cd3c947097d2ccc4c16f120d50458314dd0"},
            theme: {render(state, instance){const container = document.createElement('div');container.lang="en-US";container.className='gitment-container gitment-root-container';container.appendChild(instance.renderHeader(state, instance));container.appendChild(instance.renderEditor(state, instance));container.appendChild(instance.renderComments(state, instance));container.appendChild(instance.renderFooter(state, instance));return container;}}
        })
        gitment.render(document.getElementById('comments'))
    }
})();</script><div class="scroll-top"><span class="arrow-icon"></span></div><footer class="app-footer"><p class="copyright" align="center">&copy; 2017 - 2018 南琴浪博客 <a>(sometimesnaive.org)<a></a></a></p></footer><script src="https://static.sometimesnaive.org:9004/deps/js/function.min.js" type="application/javascript"></script><script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-108266909-1","auto"),ga("send","pageview")</script><script async src="https://www.google-analytics.com/analytics.js" type="application/javascript"></script></body></html><!-- rebuild by neat -->