<!-- build time:Thu May 03 2018 22:55:47 GMT+0800 (中国标准时间) --><!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0" name="viewport"><link href="https://static.sometimesnaive.org:9004/deps/imgs/favicon.ico" type="image/x-icon" rel="icon"><title>魔改 BBR 一键脚本 for Debian &amp; CentOS | 南琴浪博客</title><link href="https://static.sometimesnaive.org:9004/deps/css/style.min.css" type="text/css" rel="stylesheet"><script src="https://static.sometimesnaive.org:9004/deps/js/jquery.min.js" type="application/javascript"></script><link href="https://static.sometimesnaive.org:9004/deps/css/nprogress.min.css" type="text/css" rel="stylesheet"><script src="https://static.sometimesnaive.org:9004/deps/js/nprogress.min.js" type="application/javascript"></script><link href="https://static.sometimesnaive.org:9004/deps/css/prism.min.css" type="text/css" rel="stylesheet"><script src="https://static.sometimesnaive.org:9004/deps/js/prism.min.js" type="application/javascript"></script><link href="https://static.sometimesnaive.org:9004/deps/css/gitment.min.css" type="text/css" rel="stylesheet"><script src="https://static.sometimesnaive.org:9004/deps/js/gitment.min.js" type="application/javascript"></script></head><body><header class="header fixed-header"><div class="header-container"><a class="home-link" href="/">南琴浪博客</a><ul class="right-list"><li class="list-item"><a href="/" class="item-link">Home</a></li><li class="list-item"><a href="/archive/" class="item-link">Archive</a></li><li class="list-item"><a href="/portal/atom.xml" class="item-link">RSS</a></li><li class="list-item"><a href="/portal/friendly-links" class="item-link">Links</a></li></ul><div class="menu-mask"><ul class="menu-list"><li class="menu-item"><a href="/" class="menu-link">Home</a></li><li class="menu-item"><a href="/archive/" class="menu-link">Archive</a></li><li class="menu-item"><a href="/portal/atom.xml" class="menu-link">RSS</a></li><li class="menu-item"><a href="/portal/friendly-links" class="menu-link">Links</a></li></ul></div></div></header><div id="article-banner"><h2>魔改 BBR 一键脚本 for Debian & CentOS</h2><p class="post-date">12/23/2017</p></div><main class="app-body flex-box"><article class="post-article"><section class="markdown-content"><p>魔改 BBR 一键脚本，包含 Debian &amp;&amp; CentOS 两个版本。<br><a id="more"></a></p><p>此文所述版本，仅适用于 <code>KVM</code> 的 Debian 7+ (32/64 bit) 或 CentOS 6+ (64 bit)。</p><p>OpenVZ 请看 <a href="https://sometimesnaive.org/article/39" rel="external nofollow noopener noreferrer" target="_blank">LKL</a> 或 <a href="https://sometimesnaive.org/article/54" rel="external nofollow noopener noreferrer" target="_blank">Rinetd</a> 分支。</p><p>BBR 是出自谷歌员工之手的应用于 Linux 内核中的拥塞控制技术。关于拥塞控制技术，可以参看我之前的一篇帖子： <a href="https://sometimesnaive.org/article/8" rel="external nofollow noopener noreferrer" target="_blank">也谈TCP拥塞控制技术 与BBR的加速原理</a></p><p>项目地址：https://github.com/nanqinlang-tcp/tcp_nanqinlang</p><h2 id="开始使用"><a href="#开始使用" class="headerlink" title="开始使用"></a>开始使用</h2><p>这个是 <code>新手简装</code> 版本，只需 <code>运行脚本第一项+重启+运行脚本第二项</code>。一般用户只需使用此版本，并建议使用该版本。此版本不需要编译的过程，直接安装 v4.10.2 内核。</p><pre><code class="language-bash"># Debian 7+
# fool
wget https://github.com/nanqinlang-tcp/tcp_nanqinlang/releases/download/3.4.3/tcp_nanqinlang-fool-1.2.3.sh
bash tcp_nanqinlang-fool-1.2.3.sh
</code></pre><p>这个是 <code>进阶</code> 版本。提供自定义内核版本功能，只建议有<code>用户自己指定安装的内核的版本</code>需求的用户使用，例如你想安装 v4.12.10 版本的内核，就需要使用这个版本。目前此版本脚本提供 linux kernel <code>v4.9.3 ~ v4.14.32</code> 支持。</p><pre><code class="language-bash"># Debian 7+
# pro
wget https://github.com/nanqinlang-tcp/tcp_nanqinlang/releases/download/3.4.3.1/tcp_nanqinlang-pro-3.4.3.1.sh
bash tcp_nanqinlang-pro-3.4.3.1.sh
</code></pre><p>这个是 <code>CentOS</code> 平台的版本，仍未确定为正式版，请勿在重要环境使用。</p><pre><code class="language-bash"># CentOS 6/7
# only 64 bit
wget https://raw.githubusercontent.com/nanqinlang-tcp/tcp_nanqinlang/master/General/CentOS/bash/tcp_nanqinlang-1.3.2.sh
bash tcp_nanqinlang-1.3.2.sh
</code></pre><h2 id="使用说明"><a href="#使用说明" class="headerlink" title="使用说明"></a>使用说明</h2><p>出现四个选项供以选择：</p><h3 id="安装内核"><a href="#安装内核" class="headerlink" title="安装内核"></a>安装内核</h3><p><code>必须使用此命令安装内核并重启！</code></p><p>安装内核时，请注意区别：</p><ul><li><p>Debian</p><ul><li>下载内核安装包至 /home/tcp_nanqinlang，脚本第二项运行完成后移除该文件夹</li><li>系统中只会留下新安装的内核，原有的所有内核都会被移除</li><li>对于 pro 版本，安装的内核版本由你指定，若不确定应输入哪个版本号，直接回车即可，会安装 v4.10.10 版本内核</li><li>指定安装内核版本为 v4.13.x 时，会使用新版本内核适配的源码</li><li>本魔改项目暂不支持 v4.14 及以上版本内核</li><li>此命令执行完毕后，请根据脚本内提示确认内核是否已安装完毕</li></ul></li><li><p>CentOS：套路和上面 Debian 的大致相当，主要在于以下区别：</p><ul><li>不会询问安装版本号，直接安装内核版本 v4.12.10</li><li>内核安装完成后，系统中会装有 <code>linux-ml-4.12.10</code> <code>linux-ml-devel-4.12.10</code> <code>linux-ml-headers-4.12.10</code> 三个内核</li><li>内核安装完成后，系统中依旧会留有旧版本的 linux-x.xx.xx-ml 内核，这些残留的内核，会在执行第二个选项 “安装并启用算法” 后被移除</li></ul></li></ul><p>确认内核更换完成后，<code>重启你的 vps</code>。</p><p>重启开机后，<code>再次运行该脚本，选择第二项: 安装并开启算法</code>。</p><h3 id="开启算法"><a href="#开启算法" class="headerlink" title="开启算法"></a>开启算法</h3><p>用于编译并启用魔改 BBR 算法。</p><h3 id="检查运行状态"><a href="#检查运行状态" class="headerlink" title="检查运行状态"></a>检查运行状态</h3><p>用于检查 tcp_nanqinlang 是否已被 加载 (installed) 和 启用 (running)。</p><h3 id="卸载"><a href="#卸载" class="headerlink" title="卸载"></a>卸载</h3><p>不会删除已安装的内核，仅移除 sysctl.conf 中的相关设置项。然后重启机器后，魔改 BBR 才会停止运作。</p><h2 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h2><ol><li>一定要在执行完成 <code>安装内核</code> 并重启 vps 后，才能执行 <code>安装并启用算法</code></li><li>卸载命令不会改动内核</li><li>若 pro 版本的编译过程报错，请留言</li></ol><h2 id="手动教程"><a href="#手动教程" class="headerlink" title="手动教程"></a>手动教程</h2><p>以下是 Debian or CentOS 的手动安装的教程：</p><ul><li>https://sometimesnaive.org/article/38</li><li>https://sometimesnaive.org/article/26</li></ul></section><br><div class="article-footer"><br><p>本文可能过时失效，若需更新，请留言</p><p>本博客文章均为原创，转载请注明来源</p></div><div class="nav-container"><a class="nav-right" href="/article/36.html">Nginx 启用 proxy_cache 缓存 <span class="nav-arrow">→</span> </a><a class="nav-left" href="/article/38.html"><span class="nav-arrow">← </span>魔改 BBR 手动安装教程（Debian 篇）</a></div><div id="comments"></div></article><aside class="catalog-container"><div class="toc-main"><strong class="toc-title">Catalog</strong><ol class="toc-nav"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#开始使用"><span class="toc-nav-text">开始使用</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#使用说明"><span class="toc-nav-text">使用说明</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#安装内核"><span class="toc-nav-text">安装内核</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#开启算法"><span class="toc-nav-text">开启算法</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#检查运行状态"><span class="toc-nav-text">检查运行状态</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#卸载"><span class="toc-nav-text">卸载</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#注意事项"><span class="toc-nav-text">注意事项</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#手动教程"><span class="toc-nav-text">手动教程</span></a></li></ol></div></aside></main><script>!function(){var e="https://static.sometimesnaive.org:9004/deps/imgs/banner.jpg";$("#article-banner").css({"background-image":"url("+e+")"}),$(".header").removeClass("fixed-header")}()</script><script>(function(){
    var gitmentConfig = "nanqinlang"
    if (gitmentConfig !== 'undefined') {
        var gitment = new Gitment({
            id: "37",
            owner: "nanqinlang",
            repo: "sometimesnaive.org",
            oauth: {client_id: "b0612de512484ab34c7a", client_secret: "c2bc4cd3c947097d2ccc4c16f120d50458314dd0"},
            theme: {render(state, instance){const container = document.createElement('div');container.lang="en-US";container.className='gitment-container gitment-root-container';container.appendChild(instance.renderHeader(state, instance));container.appendChild(instance.renderEditor(state, instance));container.appendChild(instance.renderComments(state, instance));container.appendChild(instance.renderFooter(state, instance));return container;}}
        })
        gitment.render(document.getElementById('comments'))
    }
})();</script><div class="scroll-top"><span class="arrow-icon"></span></div><footer class="app-footer"><p class="copyright" align="center">&copy; 2017 - 2018 南琴浪博客 <a>(sometimesnaive.org)<a></a></a></p></footer><script src="https://static.sometimesnaive.org:9004/deps/js/function.min.js" type="application/javascript"></script><script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-108266909-1","auto"),ga("send","pageview")</script><script async src="https://www.google-analytics.com/analytics.js" type="application/javascript"></script></body></html><!-- rebuild by neat -->