<!-- build time:Sat May 05 2018 01:46:53 GMT+0800 (中国标准时间) --><!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0" name="viewport"><link href="https://static.sometimesnaive.org:9004/deps/imgs/favicon.ico" type="image/x-icon" rel="icon"><title>Nginx 启用 GZip 压缩 | 南琴浪博客</title><link href="https://static.sometimesnaive.org:9004/deps/css/style.min.css" type="text/css" rel="stylesheet"><script src="https://static.sometimesnaive.org:9004/deps/js/jquery.min.js" type="application/javascript"></script><link href="https://static.sometimesnaive.org:9004/deps/css/nprogress.min.css" type="text/css" rel="stylesheet"><script src="https://static.sometimesnaive.org:9004/deps/js/nprogress.min.js" type="application/javascript"></script><link href="https://static.sometimesnaive.org:9004/deps/css/prism.min.css" type="text/css" rel="stylesheet"><script src="https://static.sometimesnaive.org:9004/deps/js/prism.min.js" type="application/javascript"></script><link href="https://static.sometimesnaive.org:9004/deps/css/gitment.min.css" type="text/css" rel="stylesheet"><script src="https://static.sometimesnaive.org:9004/deps/js/gitment.min.js" type="application/javascript"></script></head><body><header class="header fixed-header"><div class="header-container"><a class="home-link" href="/">南琴浪博客</a><ul class="right-list"><li class="list-item"><a href="/" class="item-link">Home</a></li><li class="list-item"><a href="/archive/" class="item-link">Archive</a></li><li class="list-item"><a href="/portal/atom.xml" class="item-link">RSS</a></li><li class="list-item"><a href="/portal/friendly-links" class="item-link">Links</a></li></ul><div class="menu-mask"><ul class="menu-list"><li class="menu-item"><a href="/" class="menu-link">Home</a></li><li class="menu-item"><a href="/archive/" class="menu-link">Archive</a></li><li class="menu-item"><a href="/portal/atom.xml" class="menu-link">RSS</a></li><li class="menu-item"><a href="/portal/friendly-links" class="menu-link">Links</a></li></ul></div></div></header><div id="article-banner"><h2>Nginx 启用 GZip 压缩</h2><p class="post-date">12/24/2017</p></div><main class="app-body flex-box"><article class="post-article"><section class="markdown-content"><p>站点在上线前，代码会做压缩，图片也会做压缩。而对于文本文档，在服务端发送数据之前进行压缩也很重要。GZip 压缩就是其中的一种压缩方式。<br><a id="more"></a></p><h2 id="GZip-压缩"><a href="#GZip-压缩" class="headerlink" title="GZip 压缩"></a>GZip 压缩</h2><p>以下字段的写入配置段可以为：<code>http</code> <code>server</code> <code>location</code></p><pre><code class="language-nginx">gzip            on;
gzip_vary        on;
gzip_min_length    1000;
gzip_buffers    16 10k;
gzip_comp_level 3;
gzip_proxied    any;
gzip_types        text/html;
gzip_http_version 1.0;
gzip_disable    &quot;msie6&quot;;
</code></pre><p>其中：</p><p><code>gzip</code> 值为 on/off，表示开启或关闭 GZip 压缩。</p><p><code>gzip_vary</code> 输出 Vary 响应头，在 response header 中添加 <code>Vary:Accept-Encoding</code> 这一项，用于解决某些缓存服务的可能的毛病。</p><p><code>gzip_min_length</code> 指定压缩数据的最小长度，只有大于或等于最小长度才会对其压缩。默认值是 20 字节。</p><p><code>gzip_buffers</code> 指定 GZip 压缩的 buffer 区的数量和大小。</p><p><code>gzip_comp_level</code> 压缩等级，可选值为 1~9。太高的压缩水平也会需要更多的 CPU 时间，建议指定 1~3 中的一级即可。</p><p><code>gzip_types</code> 指定允许压缩的文件类型。本文中以 html 格式为例。更多文件格式，请参考 Nginx 的默认配置文件 <code>mime.types</code>。</p><p><code>gzip_http_version</code> 默认 Nginx 只对 HTTP/1.1 及以上的请求才会启用 GZip，因为早期的 HTTP/1.0 客户端的 GZip 有缺陷。现在已不用担心此问题，设置这项的值为 1.0 来启用对 HTTP/1.0 的 GZip 压缩。</p><p><code>gzip_disable</code> 写入一个正则字符串，当 request header 中的 UserAgent 字段匹配这条正则时，response 不会启用 GZip 压缩。可用于解决在启用 GZip 压缩后某些浏览器的不兼容问题。指定值为 <code>msie6</code> 表示对 MicroSoft IE 4~6 浏览器不启用压缩。</p><h2 id="GZip-压缩的增强插件"><a href="#GZip-压缩的增强插件" class="headerlink" title="GZip 压缩的增强插件"></a>GZip 压缩的增强插件</h2><p>Nginx 默认就能提供上述功能，下面介绍两个 GZip 压缩的增强插件：</p><ul><li>http_gzip_static_module</li><li>http_gunzip_module</li></ul><p>若要启用上述插件，需要在编译 Nginx 时，加入相应模块：</p><pre><code class="language-bash">./configure  ... --with-http_gzip_static_module --with-http_gunzip_module
</code></pre><h3 id="http-gzip-static-module"><a href="#http-gzip-static-module" class="headerlink" title="http_gzip_static_module"></a>http_gzip_static_module</h3><pre><code class="language-nginx"># 配置段: http, server, location
# 值: on, off, always
gzip_static  ${value};
</code></pre><p>这个模块可以让 Nginx 发送一个已经压缩好的 .gz 文件，而不是发送普通文件。</p><p>在 gzip_static 的值设为 on 后，Nginx 会先判断客户端是否支持 .gz 文件，如果支持就发送 .gz 文件，不支持就发送普通文件。通过发送压缩过的文件来节省传输时间。</p><p>也可以将 gzip_static 的值设为 always，这时 Nginx 总是发送 .gz 文件（如果 .gz 文件存在的话），而不会检查客户端是否支持 .gz 文件。</p><h3 id="http-gunzip-module"><a href="#http-gunzip-module" class="headerlink" title="http_gunzip_module"></a>http_gunzip_module</h3><pre><code class="language-nginx"># 配置段: http, server, location
# 值: on, off
gunzip  ${value};
</code></pre><p>这个模块让 Nginx 发送一个经解压的文件给那些不支持 gzip 的客户端，并且经常与 ngx_http_gzip_static_module 搭配使用（令 gzip_static = always）。</p><p>http_gzip_static_module 发送一个已经压缩好的文件，而 http_gunzip_module 可以解压文件以让 Nginx 发送给不支持压缩的客户端。</p></section><br><div class="article-footer"><br><p>本文可能过时失效，若需更新，请留言</p><p>本博客文章均为原创，转载请注明来源</p></div><div class="nav-container"><a class="nav-right" href="/article/39.html">OpenVZ 魔改 BBR - lkl-haproxy 一键脚本 <span class="nav-arrow">→</span> </a><a class="nav-left" href="/article/41.html"><span class="nav-arrow">← </span>Hexo 搬迁记（三） 主题篇</a></div><div id="comments"></div></article><aside class="catalog-container"><div class="toc-main"><strong class="toc-title">Catalog</strong><ol class="toc-nav"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#GZip-压缩"><span class="toc-nav-text">GZip 压缩</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#GZip-压缩的增强插件"><span class="toc-nav-text">GZip 压缩的增强插件</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#http-gzip-static-module"><span class="toc-nav-text">http_gzip_static_module</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#http-gunzip-module"><span class="toc-nav-text">http_gunzip_module</span></a></li></ol></li></ol></div></aside></main><script>!function(){var e="https://static.sometimesnaive.org:9004/deps/imgs/banner.jpg";$("#article-banner").css({"background-image":"url("+e+")"}),$(".header").removeClass("fixed-header")}()</script><script>(function(){
    var gitmentConfig = "nanqinlang"
    if (gitmentConfig !== 'undefined') {
        var gitment = new Gitment({
            id: "40",
            owner: "nanqinlang",
            repo: "sometimesnaive.org",
            oauth: {client_id: "b0612de512484ab34c7a", client_secret: "c2bc4cd3c947097d2ccc4c16f120d50458314dd0"},
            theme: {render(state, instance){const container = document.createElement('div');container.lang="en-US";container.className='gitment-container gitment-root-container';container.appendChild(instance.renderHeader(state, instance));container.appendChild(instance.renderEditor(state, instance));container.appendChild(instance.renderComments(state, instance));container.appendChild(instance.renderFooter(state, instance));return container;}}
        })
        gitment.render(document.getElementById('comments'))
    }
})();</script><div class="scroll-top"><span class="arrow-icon"></span></div><footer class="app-footer"><p class="copyright" align="center">&copy; 2017 - 2018 南琴浪博客 <a>(sometimesnaive.org)<a></a></a></p></footer><script src="https://static.sometimesnaive.org:9004/deps/js/function.min.js" type="application/javascript"></script><script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-108266909-1","auto"),ga("send","pageview")</script><script async src="https://www.google-analytics.com/analytics.js" type="application/javascript"></script></body></html><!-- rebuild by neat -->