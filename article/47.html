<!-- build time:Thu May 03 2018 22:55:47 GMT+0800 (中国标准时间) --><!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0" name="viewport"><link href="https://static.sometimesnaive.org:9004/deps/imgs/favicon.ico" type="image/x-icon" rel="icon"><title>Gitment - GitHub Issue 评论系统 | 南琴浪博客</title><link href="https://static.sometimesnaive.org:9004/deps/css/style.min.css" type="text/css" rel="stylesheet"><script src="https://static.sometimesnaive.org:9004/deps/js/jquery.min.js" type="application/javascript"></script><link href="https://static.sometimesnaive.org:9004/deps/css/nprogress.min.css" type="text/css" rel="stylesheet"><script src="https://static.sometimesnaive.org:9004/deps/js/nprogress.min.js" type="application/javascript"></script><link href="https://static.sometimesnaive.org:9004/deps/css/prism.min.css" type="text/css" rel="stylesheet"><script src="https://static.sometimesnaive.org:9004/deps/js/prism.min.js" type="application/javascript"></script><link href="https://static.sometimesnaive.org:9004/deps/css/gitment.min.css" type="text/css" rel="stylesheet"><script src="https://static.sometimesnaive.org:9004/deps/js/gitment.min.js" type="application/javascript"></script></head><body><header class="header fixed-header"><div class="header-container"><a class="home-link" href="/">南琴浪博客</a><ul class="right-list"><li class="list-item"><a href="/" class="item-link">Home</a></li><li class="list-item"><a href="/archive/" class="item-link">Archive</a></li><li class="list-item"><a href="/portal/atom.xml" class="item-link">RSS</a></li><li class="list-item"><a href="/portal/friendly-links" class="item-link">Links</a></li></ul><div class="menu-mask"><ul class="menu-list"><li class="menu-item"><a href="/" class="menu-link">Home</a></li><li class="menu-item"><a href="/archive/" class="menu-link">Archive</a></li><li class="menu-item"><a href="/portal/atom.xml" class="menu-link">RSS</a></li><li class="menu-item"><a href="/portal/friendly-links" class="menu-link">Links</a></li></ul></div></div></header><div id="article-banner"><h2>Gitment - GitHub Issue 评论系统</h2><p class="post-date">01/10/2018</p></div><main class="app-body flex-box"><article class="post-article"><section class="markdown-content"><p>在之前的《Hexo 搬迁记》系列文章中，我提到过本站采用 Gitment 作为评论系统，并对其进行了一些介绍。这里再开一帖来对其进行更多的说明。<br><a id="more"></a></p><h2 id="开始使用"><a href="#开始使用" class="headerlink" title="开始使用"></a>开始使用</h2><p>关于如何为你的站点启用 Gitment，请参看这篇 <a href="https://imsun.net/posts/gitment-introduction/" rel="external nofollow noopener noreferrer" target="_blank">原作者的文章</a>，同时也可参看我之前的这两篇帖子：<a href="https://sometimesnaive.org/article/35#评论系统" rel="external nofollow noopener noreferrer" target="_blank">Hexo 搬迁记系列二 插件篇</a> 和 <a href="https://sometimesnaive.org/article/41#评论系统" rel="external nofollow noopener noreferrer" target="_blank">Hexo 搬迁记系列三 主题篇</a>。</p><p>我对 Gitment 进行了修改，并将它发布到了 <a href="https://github.com/nanqinlang-mogic/gitment" rel="external nofollow noopener noreferrer" target="_blank">Github</a>。</p><h2 id="Gitment-的缺陷"><a href="#Gitment-的缺陷" class="headerlink" title="Gitment 的缺陷"></a>Gitment 的缺陷</h2><p>Gitment 的确很方便，但他也有很明显的缺陷。这篇文章 <a href="https://aimingoo.github.io/1-1722.html" rel="external nofollow noopener noreferrer" target="_blank">手记4：谈谈Gitment中泄露secret的前因后果与解决方法</a> 进行了很详细的说明。非常感谢那位博主的文章，以及他对我的疑问的详细的解答。</p><h2 id="自建-Oauth-CORS-Service"><a href="#自建-Oauth-CORS-Service" class="headerlink" title="自建 Oauth CORS Service"></a>自建 Oauth CORS Service</h2><p>在上面提到那篇文章中，那位博主很明确地提到了一点：<code>Github OAuth 并不支持浏览器跨站访问</code>。这使得仅仅只将 Gitment 插入网页而同时却没有一个解决 CORS 问题的措施的话，你的访客是无法调用 Github OAuth API 的，导致的结果就是访客无法登录你的 Gitment，并且你的 Gitment 也是无法加载出评论的。</p><p>对于这个问题，Gitment 原作者 imsun 提供了一个很方便的解决方案：<a href="https://github.com/imsun/gh-oauth-server" rel="external nofollow noopener noreferrer" target="_blank">Oauth Server</a>。这是一个基于 Nodejs 的服务，作用是提供一个 CORS，以使客户得以调用 Github API。</p><p>如果直接使用原版 Gitment 的话，你会发现有一个指向 <code>https://gh-oauth.imsun.net</code> 的 access，这是原作者提供的一个服务，它会帮助你调用 Github API，然后返回一个 access_token。</p><p>当然，你也可以选择替换成你自己的，防止作者的服务哪天失联了。接下来介绍如何自建一个 <code>Oauth Server</code>。</p><p>首先，你需要先运行这个服务：</p><pre><code class="language-bash">git clone https://github.com/imsun/gh-oauth-server.git
npm install
npm start
</code></pre><p>以上完成后，Oauth Server 就会监听在你的 3000 端口上。接下来你需要修改 Gitment 的文件：<code>gitment.js</code> 和 <code>gitment.browser.js</code>，将这两个文件中的 “https://gh-oauth.imsun.net“ 替换为 <code>你的服务器IP:3000</code>。这样一来，你就应用了你自己的 Oauth Server 了。</p><p>当然，你也可以加入点别的特性，例如把它放到一个 HTTPS 上，就像 https://gh-oauth.imsun.net 一样。</p><p>要实现这个，以 Nginx 为例，建立一个 HTTPS Server，然后指定反代到后端的 Oauth Server：</p><pre><code class="language-nginx">server
    {
        location / {
        proxy_pass http://localhost:3000;
    }
}
</code></pre></section><br><div class="article-footer"><br><p>本文可能过时失效，若需更新，请留言</p><p>本博客文章均为原创，转载请注明来源</p></div><div class="nav-container"><a class="nav-right" href="/article/46.html">Nginx 基础教程（二）反向代理 <span class="nav-arrow">→</span> </a><a class="nav-left" href="/article/48.html"><span class="nav-arrow">← </span>DNS CAA 证书颁发机构授权</a></div><div id="comments"></div></article><aside class="catalog-container"><div class="toc-main"><strong class="toc-title">Catalog</strong><ol class="toc-nav"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#开始使用"><span class="toc-nav-text">开始使用</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#Gitment-的缺陷"><span class="toc-nav-text">Gitment 的缺陷</span></a></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#自建-Oauth-CORS-Service"><span class="toc-nav-text">自建 Oauth CORS Service</span></a></li></ol></div></aside></main><script>!function(){var e="https://static.sometimesnaive.org:9004/deps/imgs/banner.jpg";$("#article-banner").css({"background-image":"url("+e+")"}),$(".header").removeClass("fixed-header")}()</script><script>(function(){
    var gitmentConfig = "nanqinlang"
    if (gitmentConfig !== 'undefined') {
        var gitment = new Gitment({
            id: "47",
            owner: "nanqinlang",
            repo: "sometimesnaive.org",
            oauth: {client_id: "b0612de512484ab34c7a", client_secret: "c2bc4cd3c947097d2ccc4c16f120d50458314dd0"},
            theme: {render(state, instance){const container = document.createElement('div');container.lang="en-US";container.className='gitment-container gitment-root-container';container.appendChild(instance.renderHeader(state, instance));container.appendChild(instance.renderEditor(state, instance));container.appendChild(instance.renderComments(state, instance));container.appendChild(instance.renderFooter(state, instance));return container;}}
        })
        gitment.render(document.getElementById('comments'))
    }
})();</script><div class="scroll-top"><span class="arrow-icon"></span></div><footer class="app-footer"><p class="copyright" align="center">&copy; 2017 - 2018 南琴浪博客 <a>(sometimesnaive.org)<a></a></a></p></footer><script src="https://static.sometimesnaive.org:9004/deps/js/function.min.js" type="application/javascript"></script><script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-108266909-1","auto"),ga("send","pageview")</script><script async src="https://www.google-analytics.com/analytics.js" type="application/javascript"></script></body></html><!-- rebuild by neat -->